"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var XMLHttpRequestNode,btoaNode;function replacer(e,t){return null==t?void 0:t}function generateUUID(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))}function getCurrentTimeFormatted(){return(new Date).toISOString()}function getJSONTrimmed(e,t,r,n){var s,i=n.bind(e);(s=new XMLHttpRequestNode.XMLHttpRequest).open("GET",t,!0),s.setRequestHeader("Authorization","Basic "+btoaNode(r+":")),s.onload=function(){var e=s.status;200==e?i(200,s.responseText):(handleError(new Error("request failed with status: "+s.status+" for url: "+t)),i(e))},s.send()}function handleError(e){e.message&&e.message;e instanceof Event&&e.target&&"script"==e.target.localName&&e.target.id}Object.defineProperty(exports,"__esModule",{value:!0}),XMLHttpRequestNode=require("Xmlhttprequest"),btoaNode=require("btoa");var ua,MessageType={TRACK:"track",PAGE:"page",IDENTIFY:"identify"},ECommerceEvents={PRODUCTS_SEARCHED:"Products Searched",PRODUCT_LIST_VIEWED:"Product List Viewed",PRODUCT_LIST_FILTERED:"Product List Filtered",PROMOTION_VIEWED:"Promotion Viewed",PROMOTION_CLICKED:"Promotion Clicked",PRODUCT_CLICKED:"Product Clicked",PRODUCT_VIEWED:"Product Viewed",PRODUCT_ADDED:"Product Added",PRODUCT_REMOVED:"Product Removed",CART_VIEWED:"Cart Viewed",CHECKOUT_STARTED:"Checkout Started",CHECKOUT_STEP_VIEWED:"Checkout Step Viewed",CHECKOUT_STEP_COMPLETED:"Checkout Step Completed",PAYMENT_INFO_ENTERED:"Payment Info Entered",ORDER_UPDATED:"Order Updated",ORDER_COMPLETED:"Order Completed",ORDER_REFUNDED:"Order Refunded",ORDER_CANCELLED:"Order Cancelled",COUPON_ENTERED:"Coupon Entered",COUPON_APPLIED:"Coupon Applied",COUPON_DENIED:"Coupon Denied",COUPON_REMOVED:"Coupon Removed",PRODUCT_ADDED_TO_WISHLIST:"Product Added to Wishlist",PRODUCT_REMOVED_FROM_WISHLIST:"Product Removed from Wishlist",WISH_LIST_PRODUCT_ADDED_TO_CART:"Wishlist Product Added to Cart",PRODUCT_SHARED:"Product Shared",CART_SHARED:"Cart Shared",PRODUCT_REVIEWED:"Product Reviewed"},BASE_URL="http://18.222.145.124:5000/dump",CONFIG_URL="https://api.rudderlabs.com/sourceConfig",FLUSH_INTERVAL_DEFAULT=5e3,HubSpotNode=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(){}},{key:"identify",value:function(e){}},{key:"track",value:function(e){}},{key:"page",value:function(e){}},{key:"loaded",value:function(){}}]),e}(),index=HubSpotNode;ua=require("universal-analytics");var XMLHttpRequestNode$1,btoaNode$1,GANode=function(){function e(t){_classCallCheck(this,e),this.trackingID=t,this.client=""}return _createClass(e,[{key:"init",value:function(){}},{key:"identify",value:function(e){this.client=ua(this.trackingID,e.message.userId)}},{key:"track",value:function(e){this.client.event(e.message.type,e.message.event,(function(e){}))}},{key:"page",value:function(e){e.message.properties&&e.message.properties.path&&this.client.pageview(e.message.properties.path,(function(e){}))}},{key:"loaded",value:function(){}}]),e}(),index$1=GANode,integrations={HS:index,GA:index$1},RudderApp=function e(){_classCallCheck(this,e),this.build="1.0.0",this.name="RudderLabs JavaScript SDK",this.namespace="com.rudderlabs.javascript",this.version="1.0.0"},RudderLibraryInfo=function e(){_classCallCheck(this,e),this.name="RudderLabs JavaScript SDK",this.version="1.0.0"},RudderOSInfo=function e(){_classCallCheck(this,e),this.name="",this.version=""},RudderScreenInfo=function e(){_classCallCheck(this,e),this.density=0,this.width=0,this.height=0},RudderContext=function e(){_classCallCheck(this,e),this.app=new RudderApp,this.traits=null,this.library=new RudderLibraryInfo;var t=new RudderOSInfo;t.version="";var r=new RudderScreenInfo;r.width=0,r.height=0,r.density=0,t.version="",t.name="",this.userAgent=null,this.locale=null,this.ip="0.0.0.0",this.os=t,this.screen=r,this.device=null,this.network=null},RudderMessage=function(){function e(){_classCallCheck(this,e),this.channel="web",this.context=new RudderContext,this.type=null,this.action=null,this.messageId=generateUUID().toString(),this.originalTimestamp=(new Date).toISOString(),this.anonymousId=generateUUID().toString(),this.userId=null,this.event=null,this.properties={},this.integrations={},this.integrations.All=!0}return _createClass(e,[{key:"getProperty",value:function(e){return this.properties[e]}},{key:"addProperty",value:function(e,t){this.properties[e]=t}},{key:"validateFor",value:function(e){if(!this.properties)throw new Error("Key properties is required");switch(e){case MessageType.TRACK:if(!this.event)throw new Error("Key event is required for track event");if(this.event in Object.values(ECommerceEvents))switch(this.event){case ECommerceEvents.CHECKOUT_STEP_VIEWED:case ECommerceEvents.CHECKOUT_STEP_COMPLETED:case ECommerceEvents.PAYMENT_INFO_ENTERED:this.checkForKey("checkout_id"),this.checkForKey("step");break;case ECommerceEvents.PROMOTION_VIEWED:case ECommerceEvents.PROMOTION_CLICKED:this.checkForKey("promotion_id");break;case ECommerceEvents.ORDER_REFUNDED:this.checkForKey("order_id")}else this.properties.category||(this.properties.category=this.event);break;case MessageType.PAGE:break;case MessageType.SCREEN:if(!this.properties.name)throw new Error("Key 'name' is required in properties")}}},{key:"checkForKey",value:function(e){if(!this.properties[e])throw new Error("Key '"+e+"' is required in properties")}}]),e}(),RudderElement=function(){function e(){_classCallCheck(this,e),this.message=new RudderMessage}return _createClass(e,[{key:"setType",value:function(e){this.message.type=e}},{key:"setProperty",value:function(e){this.message.properties=e}},{key:"setUserProperty",value:function(e){this.message.user_properties=e}},{key:"setUserId",value:function(e){this.message.userId=e}},{key:"setEventName",value:function(e){this.message.event=e}},{key:"updateTraits",value:function(e){this.message.context.traits=e}},{key:"getElementContent",value:function(){return this.message}}]),e}(),RudderElementBuilder=function(){function e(){_classCallCheck(this,e),this.rudderProperty=null,this.rudderUserProperty=null,this.event=null,this.userId=null,this.channel=null,this.type=null}return _createClass(e,[{key:"setProperty",value:function(e){return this.rudderProperty=e,this}},{key:"setPropertyBuilder",value:function(e){return this.rudderProperty=e.build(),this}},{key:"setUserProperty",value:function(e){return this.rudderUserProperty=e,this}},{key:"setUserPropertyBuilder",value:function(e){return this.rudderUserProperty=e.build(),this}},{key:"setEvent",value:function(e){return this.event=e,this}},{key:"setUserId",value:function(e){return this.userId=e,this}},{key:"setChannel",value:function(e){return this.channel=e,this}},{key:"setType",value:function(e){return this.type=e,this}},{key:"build",value:function(){var e=new RudderElement;return e.setUserId(this.userId),e.setType(this.type),e.setEventName(this.event),e.setProperty(this.rudderProperty),e.setUserProperty(this.rudderUserProperty),e}}]),e}(),StorageNode=function(){function e(){_classCallCheck(this,e),this.storage={}}return _createClass(e,[{key:"setItem",value:function(e,t){}},{key:"setUserId",value:function(e){}},{key:"setUserTraits",value:function(e){}},{key:"getItem",value:function(e){}},{key:"getUserId",value:function(){}},{key:"getUserTraits",value:function(){}},{key:"removeItem",value:function(e){}},{key:"clear",value:function(){}}]),e}(),Storage=StorageNode,RudderPayload=function e(){_classCallCheck(this,e),this.batch=null,this.writeKey=null};XMLHttpRequestNode$1=require("Xmlhttprequest"),btoaNode$1=require("btoa");var EventRepository=function(){function e(){_classCallCheck(this,e),this.eventsBuffer=[],this.writeKey="",this.url=BASE_URL,this.state="READY",this.batchSize=0,setInterval(this.preaparePayloadAndFlush,FLUSH_INTERVAL_DEFAULT,this)}return _createClass(e,[{key:"preaparePayloadAndFlush",value:function(e){if(0!=e.eventsBuffer.length&&"PROCESSING"!==e.state){var t,r=e.eventsBuffer,n=new RudderPayload;n.batch=r,n.writeKey=e.writeKey,n.sentAt=getCurrentTimeFormatted(),n.batch.forEach((function(e){e.sentAt=n.sentAt})),e.batchSize=e.eventsBuffer.length,(t=new XMLHttpRequestNode$1.XMLHttpRequest).open("POST",e.url,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization","Basic "+btoaNode$1(n.writeKey+":")),t.onreadystatechange=function(){4===t.readyState&&200===t.status?e.eventsBuffer=e.eventsBuffer.slice(e.batchSize):4===t.readyState&&200!==t.status&&handleError(new Error("request failed with status: "+t.status+" for url: "+e.url)),e.state="READY"},t.send(JSON.stringify(n,replacer)),e.state="PROCESSING"}}},{key:"enqueue",value:function(e){this.eventsBuffer.push(e.getElementContent())}}]),e}(),eventRepository=new EventRepository,RudderProperty=function(){function e(){_classCallCheck(this,e),this.propertyMap={}}return _createClass(e,[{key:"getPropertyMap",value:function(){return this.propertyMap}},{key:"getProperty",value:function(e){return this.propertyMap[e]}},{key:"setProperty",value:function(e,t){this.propertyMap[e]=t}},{key:"setPropertyMap",value:function(e){var t=this;this.propertyMap?Object.keys(e).forEach((function(r){t.propertyMap[r]=e[r]})):this.propertyMap=e}}]),e}(),PromotionEvent=function(){function e(){_classCallCheck(this,e),this.promotion=null}return _createClass(e,[{key:"setPromotion",value:function(e){return this.promotion=e,this}},{key:"build",value:function(){var e=new RudderProperty;return e.setPropertyMap(this.promotion),e}}]),e}(),PromotionViewedEvent=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))}return _inherits(t,PromotionEvent),_createClass(t,[{key:"event",value:function(){return ECommerceEvents.PROMOTION_VIEWED}}]),t}(),ECommercePromotion=function(){function e(){_classCallCheck(this,e),this.promotion_id="",this.creative="",this.name="",this.position=0}return _createClass(e,[{key:"setPromotionId",value:function(e){return this.promotion_id=e,this}},{key:"setCreative",value:function(e){return this.creative=e,this}},{key:"setName",value:function(e){return this.name=e,this}},{key:"setPosition",value:function(e){return this.position=e,this}}]),e}();function enqueue(e){this.eventRepository||(this.eventRepository=eventRepository),this.eventRepository.enqueue(e)}var Analytics=function(){function e(){_classCallCheck(this,e),this.ready=!1,this.eventsBuffer=[],this.clientIntegrations=[],this.configArray=[],this.clientIntegrationObjects=void 0,this.toBeProcessedArray=[],this.toBeProcessedByIntegrationArray=[],this.storage=new Storage,this.userId=null!=this.storage.getUserId()?this.storage.getUserId():generateUUID(),this.userTraits=null!=this.storage.getUserTraits()?this.storage.getUserTraits():{},this.storage.setUserId(this.userId),this.eventRepository=eventRepository}return _createClass(e,[{key:"processResponse",value:function(e,t){(t=JSON.parse(t)).source.destinations.forEach((function(e,t){e.enabled&&e.config.useNativeSDK&&(this.clientIntegrations.push(e.destinationDefinition.name),this.configArray.push(e.config))}),this),this.init(this.clientIntegrations,this.configArray)}},{key:"init",value:function(e,t){var r=this;this.clientIntegrationObjects=[],e&&0!=e.length?(e.forEach((function(e){var n=integrations[e];if("HS"===e){var s=new n(t[0].hubId);s.init(),r.clientIntegrationObjects.push(s)}if("GA"===e){var i=new n(t[0].trackingID);i.init(),r.clientIntegrationObjects.push(i)}})),this.toBeProcessedByIntegrationArray.forEach((function(e){var t=e[0];e.shift();for(var n=e[0].message.integrations,s=0;s<r.clientIntegrationObjects.length;s++)if(n[r.clientIntegrationObjects[s].name]||null==n[r.clientIntegrationObjects[s].name]&&n.All)try{var i;(i=r.clientIntegrationObjects[s])[t].apply(i,_toConsumableArray(e))}catch(e){handleError(e)}})),this.toBeProcessedByIntegrationArray=[]):this.toBeProcessedByIntegrationArray=[]}},{key:"page",value:function(e,t,r,n,s){"function"==typeof n&&(s=n,n=null),"function"==typeof r&&(s=r,n=r=null),"function"==typeof t&&(s=t,n=r=t=null),"object"===_typeof(e)&&(n=t,r=e,t=e=null),"object"===_typeof(t)&&(n=r,r=t,t=null),"string"==typeof e&&"string"!=typeof t&&(t=e,e=null),this.processPage(e,t,r,n,s)}},{key:"track",value:function(e,t,r,n){"function"==typeof r&&(n=r,r=null),"function"==typeof t&&(n=t,r=null,t=null),this.processTrack(e,t,r,n)}},{key:"identify",value:function(e,t,r,n){"function"==typeof r&&(n=r,r=null),"function"==typeof t&&(n=t,r=null,t=null),"object"==_typeof(e)&&(r=t,t=e,e=this.userId),this.processIdentify(e,t,r,n)}},{key:"processPage",value:function(e,t,r,n,s){var i=(new RudderElementBuilder).setType("page").build();t&&(i.message.name=t),e&&(r||(r={}),r.category=e),r&&(i.message.properties=r),this.trackPage(i,n,s)}},{key:"processTrack",value:function(e,t,r,n){var s=(new RudderElementBuilder).setType("track").build();e&&s.setEventName(e),t?s.setProperty(t):s.setProperty({}),this.trackEvent(s,r,n)}},{key:"processIdentify",value:function(e,t,r,n){this.userId=e,this.storage.setUserId(this.userId);var s=(new RudderElementBuilder).setType("identify").build();t&&(this.userTraits=t,this.storage.setUserTraits(this.userTraits)),this.identifyUser(s,r,n)}},{key:"identifyUser",value:function(e,t,r){e.message.userId&&(this.userId=e.message.userId,this.storage.setUserId(this.userId)),e&&e.message&&e.message.context&&e.message.context.traits&&(this.userTraits=e.message.context.traits,this.storage.setUserTraits(this.userTraits)),this.processAndSendDataToDestinations("identify",e,t,r)}},{key:"trackPage",value:function(e,t,r){this.processAndSendDataToDestinations("page",e,t,r)}},{key:"trackEvent",value:function(e,t,r){this.processAndSendDataToDestinations("track",e,t,r)}},{key:"processAndSendDataToDestinations",value:function(e,t,r,n){try{this.userId||(this.userId=generateUUID(),this.storage.setUserId(this.userId)),t.message.context.traits=this.userTraits,t.message.anonymousId=t.message.userId=t.message.context.traits.anonymousId=this.userId,r&&this.processOptionsParam(t,r);var s=t.message.integrations;this.clientIntegrationObjects&&this.clientIntegrationObjects.forEach((function(r){(s[r.name]||null==s[r.name]&&s.All)&&r[e](t)})),this.clientIntegrationObjects||this.toBeProcessedByIntegrationArray.push([e,t]),enqueue.call(this,t),n&&n()}catch(e){handleError(e)}}},{key:"processOptionsParam",value:function(e,t){var r=["integrations","anonymousId","originalTimestamp"];for(var n in t)if(r.includes(n))e.message[n]=t[n];else if("context"!==n)e.message.context[n]=t[n];else for(var s in t[n])e.message.context[s]=t[n][s]}},{key:"reset",value:function(){this.userId="",this.userTraits={},this.storage.clear()}},{key:"load",value:function(e,t){this.eventRepository.writeKey=e,t&&(this.eventRepository.url=t),getJSONTrimmed(this,CONFIG_URL,e,this.processResponse)}}]),e}(),instance=new Analytics,identify=instance.identify.bind(instance),page=instance.page.bind(instance),track=instance.track.bind(instance),trackEvent=instance.trackEvent.bind(instance),trackPage=instance.trackPage.bind(instance),identifyUser=instance.identifyUser.bind(instance),reset=instance.reset.bind(instance),load=instance.load.bind(instance);exports.ECommerceEvents=ECommerceEvents,exports.ECommercePromotion=ECommercePromotion,exports.PromotionViewedEvent=PromotionViewedEvent,exports.RudderElementBuilder=RudderElementBuilder,exports.identify=identify,exports.identifyUser=identifyUser,exports.load=load,exports.page=page,exports.reset=reset,exports.track=track,exports.trackEvent=trackEvent,exports.trackPage=trackPage;
